<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="mt2m10"/><meta name="twitter:creator" content="mt2m10"/><meta property="og:site_name" content="mt2m10"/><link rel="canonical" href="https://mt2m10.github.io"/><title>Amazon Linux 2 + Apache + Codeigniter4 でのWebサーバ構築</title><meta name="description" content="Amazon Linux 2 インスタンスに Apache HTTP Server と PHP8 をインストールしてWebサーバを構築します"/><meta name="robots" content="index,follow"/><meta property="og:title" content="Amazon Linux 2 + Apache + Codeigniter4 でのWebサーバ構築"/><meta property="og:description" content="Amazon Linux 2 インスタンスに Apache HTTP Server と PHP8 をインストールしてWebサーバを構築します"/><meta property="og:url" content="https://mt2m10.github.io/posts/2021-09-15_build-webserver"/><meta property="og:type" content="website"/><meta name="next-head-count" content="14"/><script src="/static/js/main.js" defer=""></script><link rel="preload" href="/_next/static/css/40158d00d5e789c1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/40158d00d5e789c1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-d7b038a63b619762.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-fc7d2f0e2098927e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0df5420adcdd9e85.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c74b419ea5c8bdcc.js" defer=""></script><script src="/_next/static/zRCHxF3fqEOSIvPy0_r4J/_buildManifest.js" defer=""></script><script src="/_next/static/zRCHxF3fqEOSIvPy0_r4J/_ssgManifest.js" defer=""></script><script src="/_next/static/zRCHxF3fqEOSIvPy0_r4J/_middlewareManifest.js" defer=""></script></head><body><header><nav><h2><a href="/">mt2m10</a></h2><ul><li><h2><a href="https://twitter.com/mt2m10" target="_blank" rel="noreferrer" id="twitter"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></h2></li><li><h2><a href="#" class="colorToggle" id="color-scheme-light" style="display:none"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 8a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0z"></path><path fill-rule="evenodd" d="M8.202.28a.25.25 0 00-.404 0l-.91 1.255a.25.25 0 01-.334.067L5.232.79a.25.25 0 00-.374.155l-.36 1.508a.25.25 0 01-.282.19l-1.532-.245a.25.25 0 00-.286.286l.244 1.532a.25.25 0 01-.189.282l-1.509.36a.25.25 0 00-.154.374l.812 1.322a.25.25 0 01-.067.333l-1.256.91a.25.25 0 000 .405l1.256.91a.25.25 0 01.067.334L.79 10.768a.25.25 0 00.154.374l1.51.36a.25.25 0 01.188.282l-.244 1.532a.25.25 0 00.286.286l1.532-.244a.25.25 0 01.282.189l.36 1.508a.25.25 0 00.374.155l1.322-.812a.25.25 0 01.333.067l.91 1.256a.25.25 0 00.405 0l.91-1.256a.25.25 0 01.334-.067l1.322.812a.25.25 0 00.374-.155l.36-1.508a.25.25 0 01.282-.19l1.532.245a.25.25 0 00.286-.286l-.244-1.532a.25.25 0 01.189-.282l1.508-.36a.25.25 0 00.155-.374l-.812-1.322a.25.25 0 01.067-.333l1.256-.91a.25.25 0 000-.405l-1.256-.91a.25.25 0 01-.067-.334l.812-1.322a.25.25 0 00-.155-.374l-1.508-.36a.25.25 0 01-.19-.282l.245-1.532a.25.25 0 00-.286-.286l-1.532.244a.25.25 0 01-.282-.189l-.36-1.508a.25.25 0 00-.374-.155l-1.322.812a.25.25 0 01-.333-.067L8.203.28zM8 2.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11z" clip-rule="evenodd"></path></svg></a><a href="#" class="colorToggle" id="color-scheme-dark" style="display:none"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M14.53 10.53a7 7 0 01-9.058-9.058A7.003 7.003 0 008 15a7.002 7.002 0 006.53-4.47z" clip-rule="evenodd"></path></svg></a></h2></li></ul></nav></header><div id="__next"><main><h1>Amazon Linux 2 + Apache + Codeigniter4 でのWebサーバ構築</h1><small><time datestring="2021-09-15">2021-09-15</time></small><article><p>Amazon Linux 2 インスタンスに Apache HTTP Server と PHP8 をインストールしてWebサーバを構築します。<br>
Codeigniter4のソースコードを利用したかったので、それ用に少しアレンジしています。</p>
<h3>環境</h3>
<ul>
<li>Amazon Linux 2 (EC2)</li>
<li>PHP 8.0.8</li>
<li>Apache HTTP Server 2.4</li>
<li>Codeigniter 4</li>
</ul>
<h3>手順</h3>
<ol>
<li>
<p>PHP 8 とApache HTTP Server をインストール</p>
<pre><code>$ sudo amazon-linux-extras enable php8.0
$ sudo yum install -y httpd php php-devel php-mysqlnd php-mbstring php-gd php-xml php-opcache php-pecl-zip php-pear php-intl mod_ssl
</code></pre>
</li>
<li>
<p>Apache HTTP Server を有効化 + 起動</p>
<pre><code>$ sudo systemctl enable httpd
$ sudo systemctl start httpd
</code></pre>
</li>
<li>
<p>ファイルの許可設定<br>
ec2-user を apache グループに追加し、apache ディレクトリの所有権を /var/www グループに付与し、グループへの書き込み権限を割り当てます。</p>
<pre><code>$ sudo usermod -a -G apache ec2-user
$ exit
</code></pre>
<p>再ログインして、グループが適用されているか確認する。</p>
<pre><code>$ groups
</code></pre>
<p><code>/var/www</code> 配下のグループと所有権を変更する。</p>
<pre><code>$ sudo chown -R ec2-user:apache /var/www
$ sudo chmod 2775 /var/www &#x26;&#x26; find /var/www -type d -exec $ sudo chmod 2775 {} \;
$ find /var/www -type f -exec sudo chmod 0664 {} \;
</code></pre>
</li>
<li>
<p>(オプション) Composer のインストール<br>
個人的に Composer を使いたかったのでインストールしています。</p>
<pre><code>$ sudo su -

# php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
# php -r "if (hash_file('sha384', 'composer-setup.php') === '756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
# php composer-setup.php
# php -r "unlink('composer-setup.php');"
# mv composer.phar /usr/local/bin/composer
# chmod 777 /usr/local/bin/composer
</code></pre>
</li>
<li>
<p>SSL/TLS の設定<br>
自己署名のデジタル証明書を使用して、Amazon Linux 2 で TLS をセットアップしてきます。</p>
<p>サーバーホスト用の自己署名 X.509 証明書とプライベートキーを生成するためのスクリプトを利用してセットアップします。<br>
作成された <code>localhost.crt</code> には証明書とキーの両方が含まれています。</p>
<pre><code># cd /etc/pki/tls/certs
# ./make-dummy-cert localhost.crt
</code></pre>
<p><code>/etc/httpd/conf.d/ssl.conf </code> を編集します。</p>
<ul>
<li><code>DocumentRoot "/var/www/html/public"</code> を追加</li>
<li><code>SSLCertificateKeyFile /etc/pki/tls/private/localhost.key</code> をコメントアウト</li>
</ul>
<p><code>/etc/httpd/conf.d/vhost.conf</code> を新規追加します（<code>vhost.conf</code> というファイル名でなくてもOK）。</p>
<pre><code>&#x3C;Directory "/var/www/html">
    AllowOverride All
&#x3C;/Directory>

&#x3C;VirtualHost *:80>
    DocumentRoot "/var/www/html/public"
&#x3C;/VirtualHost>
</code></pre>
<p>完了したら <code>Apache HTTP Server</code> を再起動します。</p>
<pre><code># systemctl restart httpd
# exit
</code></pre>
</li>
<li>
<p>Codeigniter プロジェクトを作成</p>
<pre><code>$ cd /var/www/
$ composer create-project codeigniter4/appstarter html
</code></pre>
</li>
</ol>
<h3>参考</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-lamp-amazon-linux-2.html">チュートリアル: Amazon Linux 2 に LAMP ウェブサーバーをインストールする</a></li>
<li><a href="https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/SSL-on-amazon-linux-2.html">チュートリアル: Amazon Linux 2 に SSL/TLS を設定する</a></li>
<li><a href="https://e-kamo.net/amazon-linux-extras-php8-available">Amazon Linux 2 の Extras Library に PHP8.0 登場</a></li>
</ul>
</article></main></div><footer>© 2022 mt2m10</footer><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blog":{"id":"2021-09-15_build-webserver","title":"Amazon Linux 2 + Apache + Codeigniter4 でのWebサーバ構築","publishedAt":"2021-09-15","body":"\u003cp\u003eAmazon Linux 2 インスタンスに Apache HTTP Server と PHP8 をインストールしてWebサーバを構築します。\u003cbr\u003e\nCodeigniter4のソースコードを利用したかったので、それ用に少しアレンジしています。\u003c/p\u003e\n\u003ch3\u003e環境\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAmazon Linux 2 (EC2)\u003c/li\u003e\n\u003cli\u003ePHP 8.0.8\u003c/li\u003e\n\u003cli\u003eApache HTTP Server 2.4\u003c/li\u003e\n\u003cli\u003eCodeigniter 4\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e手順\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003ePHP 8 とApache HTTP Server をインストール\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo amazon-linux-extras enable php8.0\n$ sudo yum install -y httpd php php-devel php-mysqlnd php-mbstring php-gd php-xml php-opcache php-pecl-zip php-pear php-intl mod_ssl\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eApache HTTP Server を有効化 + 起動\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo systemctl enable httpd\n$ sudo systemctl start httpd\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eファイルの許可設定\u003cbr\u003e\nec2-user を apache グループに追加し、apache ディレクトリの所有権を /var/www グループに付与し、グループへの書き込み権限を割り当てます。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo usermod -a -G apache ec2-user\n$ exit\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再ログインして、グループが適用されているか確認する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ groups\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e/var/www\u003c/code\u003e 配下のグループと所有権を変更する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo chown -R ec2-user:apache /var/www\n$ sudo chmod 2775 /var/www \u0026#x26;\u0026#x26; find /var/www -type d -exec $ sudo chmod 2775 {} \\;\n$ find /var/www -type f -exec sudo chmod 0664 {} \\;\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e(オプション) Composer のインストール\u003cbr\u003e\n個人的に Composer を使いたかったのでインストールしています。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo su -\n\n# php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"\n# php -r \"if (hash_file('sha384', 'composer-setup.php') === '756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"\n# php composer-setup.php\n# php -r \"unlink('composer-setup.php');\"\n# mv composer.phar /usr/local/bin/composer\n# chmod 777 /usr/local/bin/composer\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSSL/TLS の設定\u003cbr\u003e\n自己署名のデジタル証明書を使用して、Amazon Linux 2 で TLS をセットアップしてきます。\u003c/p\u003e\n\u003cp\u003eサーバーホスト用の自己署名 X.509 証明書とプライベートキーを生成するためのスクリプトを利用してセットアップします。\u003cbr\u003e\n作成された \u003ccode\u003elocalhost.crt\u003c/code\u003e には証明書とキーの両方が含まれています。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# cd /etc/pki/tls/certs\n# ./make-dummy-cert localhost.crt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e/etc/httpd/conf.d/ssl.conf \u003c/code\u003e を編集します。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eDocumentRoot \"/var/www/html/public\"\u003c/code\u003e を追加\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eSSLCertificateKeyFile /etc/pki/tls/private/localhost.key\u003c/code\u003e をコメントアウト\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003e/etc/httpd/conf.d/vhost.conf\u003c/code\u003e を新規追加します（\u003ccode\u003evhost.conf\u003c/code\u003e というファイル名でなくてもOK）。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026#x3C;Directory \"/var/www/html\"\u003e\n    AllowOverride All\n\u0026#x3C;/Directory\u003e\n\n\u0026#x3C;VirtualHost *:80\u003e\n    DocumentRoot \"/var/www/html/public\"\n\u0026#x3C;/VirtualHost\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e完了したら \u003ccode\u003eApache HTTP Server\u003c/code\u003e を再起動します。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# systemctl restart httpd\n# exit\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCodeigniter プロジェクトを作成\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ cd /var/www/\n$ composer create-project codeigniter4/appstarter html\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e参考\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-lamp-amazon-linux-2.html\"\u003eチュートリアル: Amazon Linux 2 に LAMP ウェブサーバーをインストールする\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/SSL-on-amazon-linux-2.html\"\u003eチュートリアル: Amazon Linux 2 に SSL/TLS を設定する\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://e-kamo.net/amazon-linux-extras-php8-available\"\u003eAmazon Linux 2 の Extras Library に PHP8.0 登場\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2021-09-15_build-webserver"},"buildId":"zRCHxF3fqEOSIvPy0_r4J","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>